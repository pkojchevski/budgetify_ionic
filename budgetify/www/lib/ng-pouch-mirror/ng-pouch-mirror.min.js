/**
 * @license ng-pouch-mirror 0.1.0
 * (c) 2015 Colin Skow
 * License: MIT
 */
!function(n,o){"use strict";n.module("pouchMirror",[]).run(["$window","$rootScope",function(n,o){o.online=n.navigator.onLine,n.addEventListener("offline",function(){o.online=!1,o.$broadcast("offline")}),n.addEventListener("online",function(){o.online=!0,o.$broadcast("online")})}]).factory("PouchMirror",["$rootScope","$q",function(n,e){return function(r,t,a){function i(){return{status:b,active:v,ready:w}}function c(){h=!1,t&&n.online&&!y?(m||(m=new o(t,a)),$=o.sync(m,p,{live:!0,retry:!0}).on("active",function(){v=!0,n.$broadcast("pm:update",r,"active",i())}).on("paused",function(){v=!1,w||(w=!0,n.$broadcast("pm:update",r,"ready",i())),n.$broadcast("pm:update",r,"paused",i())}).on("complete",function(o){v=!1,y=!1,f(o)?(b="error",n.$broadcast("pm:error",r,{error:"unauthorized"},i(),o)):(b="stopped",n.$broadcast("pm:update",r,"stopped",i(),o))}).on("denied",function(o){n.$broadcast("pm:denied",r,o,i())}).on("error",function(o){v=!1,b="error",n.$broadcast("pm:error",r,o,i())}),y=!0,b="syncing"):(n.online||(b="offline"),w||(w=!0,n.$broadcast("pm:update",r,"ready",i())))}function u(){y&&($.cancel(),y=!1)}function d(){h=!0,b="stopped",w="false",u()}function s(){return d(),e.all([l.destroy(),p.destroy()])}function f(n){var o=!1;return n.push&&n.push.errors&&n.push.errors.forEach(function(n){("unauthorized"===n.name||"forbidden"===n.name)&&(o=!0)}),n.pull&&n.pull.errors&&n.pull.errors.forEach(function(n){("unauthorized"===n.name||"forbidden"===n.name)&&(o=!0)}),o}var p,l,m,$,y=!1,h=!0,b="stopped",v=!1,w=!1;return a=a||{},r||(r="pouch"),p=new o(r+"_mem",{adapter:"memory"}),l=new o(r),l.replicate.to(p).then(function(){p.replicate.to(l,{live:!0}),c()}),n.$on("online",function(){h||c()}),n.$on("offline",function(){h||(b="offline"),u()}),p.startSync=c,p.stopSync=d,p.syncStatus=i,p.destroyLocal=s,p}}])}(angular,PouchDB);
//# sourceMappingURL=true
//# sourceMappingURL=ng-pouch-mirror.min.js.map